<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/Home/home.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/Home/home.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from "react";
import "./home.css";
import text from "../../assets/language/en.js";
import PouchDB from "pouchdb";
import Papa from "papaparse";
import { createSelector } from "reselect";
import { connect } from "react-redux";
import Modal from 'react-bootstrap/Modal';
import { openProject, clearAllAttributes } from "../Home/homeAction";
import { initFileBox } from "../TaggingTool/Settings/Upload/uploadAction";
import { updateSingleTokens, updateVocab, setTokens } from "../TaggingTool/Tag/Single/singleTokensAction";
import { updateMultiTokens } from "../TaggingTool/Tag/Multi/multiTokensAction";
import { updateHeaders } from "../TaggingTool/Settings/Headers/headersAction";
import { headersRequest } from "../TaggingTool/Settings/Headers/headersAction";
import { initReport } from "../TaggingTool/Report/reportAction";
import Accordion from 'react-bootstrap/Accordion'
import Card from 'react-bootstrap/Card'
import Button from "react-bootstrap/Button"
import { updateDashboardHeaders, displayDashboardHeaders } from "../Dashboard/Settings/dashboardHeaders/dashboardHeadersAction";

/**
 * Component for home page.
 * 
 * @component
 */
class HomeComponent extends Component {

  /** 
   * @constructor
  */
  constructor(props) {
    super(props);
    this.state = {
      showModal: false,
      listOfProjects: [],
      projectOpened: '',
      lastRow: null
    };
  }

  /**
   * A react lifecycle method called when the component did mount.
   * It loads the list of projects from the database
   */
  componentDidMount() {
    window.db = new PouchDB("testdatabase");
    let tmpListOfProjects = [];
    window.db.allDocs().then((result) => {
      result.rows.forEach(element => {
        window.db.get(element.id).then((project) => {
          tmpListOfProjects.push({
            name: project._id,
            lastModification: project.details.lastModification,
            originalFile: project.details.originalFile,
            originalLocation: project.details.originalLocation
          });
        });
      });
      this.setState({ listOfProjects: tmpListOfProjects });
    });
  }

  /**
   * The render function.
   */
  render() {
    return (
      &lt;div className="home-container">
        &lt;div className="title">{text.home.header}&lt;/div>
        &lt;div className="button text-center">
          &lt;button className="btn-dark" onClick={this.newProject}>
            {text.home.button.newProject}
          &lt;/button>
          &lt;br />
          &lt;br />
          &lt;button className="btn-light"
            onClick={this.handleShowModal}
            label="Open Project">
            {text.home.button.openProject}
          &lt;/button>
        &lt;/div>
        &lt;Modal
          show={this.state.showModal}
          onHide={this.handleHideModal}>
          &lt;Modal.Header>
            &lt;Modal.Title>&lt;i className="far fa-folder-open">&lt;/i>&amp;nbsp;&amp;nbsp;List of projects&lt;/Modal.Title>
          &lt;/Modal.Header>
          &lt;Modal.Body>
            {this.state.listOfProjects.length !== 0 ? &lt;div>
              You can either select a project to open it or delete it by selecting the trash button.
            &lt;hr />
              &lt;Accordion defaultActiveKey="0">
                {this.state.listOfProjects.map((obj, i) =>
                  (
                    &lt;Card bg="light" className="project-card" key={i+1}>
                      &lt;Accordion.Toggle as={Card.Header} eventKey={i+1}>
                        {obj.name}
                      &lt;/Accordion.Toggle>
                      &lt;Accordion.Collapse eventKey={i+1}>
                        &lt;Card.Body>
                          &lt;Card.Subtitle className="mb-2 text-muted">Details&lt;/Card.Subtitle>
                          &lt;strong>Last opened&lt;/strong> : {obj.lastModification}&lt;br />
                          &lt;strong>Original input file&lt;/strong> : {obj.originalFile}&lt;br />
                          &lt;strong>Location&lt;/strong> : {obj.originalLocation}
                          &lt;hr />
                          &lt;div className="flexbox">
                            &lt;Button variant="outline-primary" onClick={() => this.handleOpenProject(obj.name)}> Open&amp;nbsp;&amp;nbsp;&lt;i className="far fa-arrow-alt-circle-right">&lt;/i>&lt;/Button>
                            &lt;Button variant="outline-danger right" onClick={() => this.handleDeleteProject(obj.name)}> Delete&amp;nbsp;&amp;nbsp;&lt;i className="far fa-trash-alt">&lt;/i>&lt;/Button>
                          &lt;/div>
                        &lt;/Card.Body>
                      &lt;/Accordion.Collapse>
                    &lt;/Card>
                  ))}
              &lt;/Accordion>&lt;/div>
              : &lt;div>
                There is no project yet in your local database. You should first upload a csv file and then you can save projects to use this menu and open them.
              &lt;/div>
            }
          &lt;/Modal.Body>
        &lt;/Modal>
      &lt;/div >);
  }

  /**
   * function called to hide the projects list modal
   */
  handleHideModal = () => {
    this.setState({ showModal: false });
  };

  /**
   * function called to show the projects list modal
   */
  handleShowModal = () => {
    this.setState({ showModal: true });
  };

  /**
   * function called to delete a project
   * It deletes the project from the database
   * and clears the state of the python script if
   * the deleted project was currently opened
   * @param {string} projectName project name to be deleted
   */
  handleDeleteProject(projectName) {
    window.db.get(projectName).then(function (doc) {
      return window.db.remove(doc);
    }).catch((error) => {
      console.log("an error occured : ".concat(error));
    }).then(() => {
      if (this.state.projectOpened === projectName) {
        this.clearApplicationState();
      }
      const newListOfProjects = this.state.listOfProjects.filter(project => {
        return project.name !== projectName;
      });
      this.setState({ listOfProjects: newListOfProjects });
    });
  }

  /**
   * function called to clear the state of the application
   * Basically, it resets all the props to null, among dragAndDrops,
   * singleTokens, multiTokens, headers, tokensNumber, and call the 
   * function clearAllattribute from the python script which reset the
   * global variables to empty in the script.
   */
  clearApplicationState = () => {
    this.props.onInitFileBox();
    this.props.onSetTokens([]);
    this.props.onClearAllAttributes();
    if (this.props.dragAndDrops[0] &amp;&amp; this.props.dragAndDrops[0].file) {
      const headers = this.props.headers;
      headers.headers = [];
      const dragAndDrops = [...this.props.dragAndDrops];
      dragAndDrops[0].file = new File([], '');
      dragAndDrops[0].projectName = '';
      const tokensNumber = this.props.tokensNumber;
      tokensNumber.value = parseInt("0");
      tokensNumber.maxValue = 0;
      const dashboard = this.props.dashboard;
      dashboard.assetSelected = {
        label: "",
        problemsRelated: "",
        mostFoundProblems: [],
        mostFoundSolutions: [],
        mostFoundItems: []
      };
      dashboard.assetsStats = [];
      this.props.onDisplayDashboardHeaders([]);
    }
  }

  /**
   * function called to open a project from the list
   * It hides the modal, and then load the project from the database
   * and set all the props to the values retrieved from the database.
   * It also redirect to the overview page
   * @param {string} projectName project name to be opened
   */
  handleOpenProject(projectName) {
    this.handleHideModal();
    let currentProject;
    window.db.get(projectName)
      .then(result => {
        currentProject = result;
        if (!this.props.dragAndDrops.length) {
          this.props.onInitFileBox();
        }
        const dragAndDrops = [...this.props.dragAndDrops];
        dragAndDrops[0].file = new File([], currentProject._id);
        dragAndDrops[0].projectName = currentProject._id;
        const headers = this.props.headers;
        headers.headers = currentProject.headers;
        const tokensNumber = this.props.tokensNumber;
        tokensNumber.value = parseInt(currentProject.tokensNumber.value);
        tokensNumber.maxValue = currentProject.tokensNumber.maxValue;
        let selectedHeadersLabels = [];
        const dashboard = this.props.dashboard;
        dashboard.assetsStats = currentProject.dashboard.assetsStats;
        dashboard.assetSelected = currentProject.dashboard.assetSelected;
        this.prepareSettingsToUpdate(currentProject.dashboardSettings);
        this.props.onDisplayDashboardHeaders(currentProject.dashboardSettings);
        headers.headers.filter((header) => {
          if (header.checked) {
            return selectedHeadersLabels.push(header.label);
          }
          return 0;
        })
        this.props.onOpenProject(Papa.unparse(currentProject.inputData.data), selectedHeadersLabels);
        if (currentProject.singleTokens) {
          this.props.onUpdateSingleTokens(JSON.parse(JSON.stringify(currentProject.singleTokens)));
          currentProject.singleTokens.forEach(token => {
            if (token.classification.label !== "") {
              this.props.onUpdateVocab(token);
            }
          });
        }
        if (currentProject.multiTokens) {
          this.props.onUpdateMultiTokens(JSON.parse(JSON.stringify(currentProject.multiTokens)));
          currentProject.multiTokens.forEach(token => {
            if (token.classification.label !== "") {
              this.props.onUpdateVocab(token);
            }
          });
        }
        this.props.history.push("/taggingTool/settings/overview");
      });
  }

  prepareSettingsToUpdate(dashboardSettings) {
    let res = {
      NA: [],
      machineName: [],
      technicianName: []
    }
    dashboardSettings.forEach(rowSetting => {
      rowSetting.checkboxes.filter((checkbox) => {
        if (checkbox.checked) {
          switch (checkbox.label) {
            case "technicianName":
              res.technicianName.push(rowSetting.rowLabel);
              break;
            case "machineName":
              res.machineName.push(rowSetting.rowLabel);
              break;
            case "NA":
              res.NA.push(rowSetting.rowLabel);
              break;
            default:
              break;
          }
        }
        return true;
      });
    });
    this.props.onUpdateDashboardHeaders(res);
  }

  /**
   * function called to create a new project
   * clear the application state and redirect to upload page
   */
  newProject = () => {
    this.clearApplicationState();
    this.props.history.push("/taggingTool/settings/upload");

  }
}
const mapStateToProps = createSelector(
  state => state.dragAndDrops,
  state => state.headers,
  state => state.tokensNumber,
  state => state.projectName,
  state => state.singleTokens,
  state => state.dashboard,
  state => state.dashboardSettings,
  (dragAndDrops, headers, tokensNumber, projectName, singleTokens, dashboard, dashboardSettings) => ({
    dragAndDrops,
    headers,
    tokensNumber,
    projectName,
    singleTokens,
    dashboard,
    dashboardSettings
  })
);
const mapActionsToProps = {
  onOpenProject: openProject,
  onInitFileBox: initFileBox,
  onUpdateSingleTokens: updateSingleTokens,
  onUpdateMultiTokens: updateMultiTokens,
  onUpdateHeaders: updateHeaders,
  onHeadersRequest: headersRequest,
  onInitReport: initReport,
  onUpdateVocab: updateVocab,
  onClearAllAttributes: clearAllAttributes,
  onSetTokens: setTokens,
  onDisplayDashboardHeaders: displayDashboardHeaders,
  onUpdateDashboardHeaders: updateDashboardHeaders
};
export default connect(
  mapStateToProps,
  mapActionsToProps
)(HomeComponent);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Alert.html">Alert</a></li><li><a href="Button.html">Button</a></li><li><a href="Classification.html">Classification</a></li><li><a href="ClassificationTag.html">ClassificationTag</a></li><li><a href="Dashboard.html">Dashboard</a></li><li><a href="dashboardHeaders.html">dashboardHeaders</a></li><li><a href="DashboardRedirect.html">DashboardRedirect</a></li><li><a href="DragAndDrop.html">DragAndDrop</a></li><li><a href="DynamicSlider.html">DynamicSlider</a></li><li><a href="Export.html">Export</a></li><li><a href="Header.html">Header</a></li><li><a href="Headers.html">Headers</a></li><li><a href="HomeComponent.html">HomeComponent</a></li><li><a href="List.html">List</a></li><li><a href="MultiRedirect.html">MultiRedirect</a></li><li><a href="MultiWord.html">MultiWord</a></li><li><a href="NavBar.html">NavBar</a></li><li><a href="Note.html">Note</a></li><li><a href="Overview.html">Overview</a></li><li><a href="OverviewHeader.html">OverviewHeader</a></li><li><a href="Pattern.html">Pattern</a></li><li><a href="Report.html">Report</a></li><li><a href="Router.html">Router</a></li><li><a href="Similarity.html">Similarity</a></li><li><a href="SingleRedirect.html">SingleRedirect</a></li><li><a href="SingleWord.html">SingleWord</a></li><li><a href="Slider.html">Slider</a></li><li><a href="TagButton.html">TagButton</a></li><li><a href="Title.html">Title</a></li><li><a href="TokensNumber.html">TokensNumber</a></li><li><a href="Upload.html">Upload</a></li><li><a href="UploadRedirect.html">UploadRedirect</a></li></ul><h3>Global</h3><ul><li><a href="global.html#DashBoard">DashBoard</a></li><li><a href="global.html#dashboardRoutes">dashboardRoutes</a></li><li><a href="global.html#DashboardSidebar">DashboardSidebar</a></li><li><a href="global.html#Error">Error</a></li><li><a href="global.html#functionhandlingthechangewhenauserselectacheckboxinthetableofthedashboardHeaders">function handling the change when a user select a checkbox in the table of the dashboard Headers</a></li><li><a href="global.html#functionthatchecksifanalertshouldberisedandthenredirecttothenextmultitoken">function that checks if an alert should be rised and then redirect to the next multitoken</a></li><li><a href="global.html#functionthathandlethechangeofthetokensfromalphabeticalorderandreverse.">function that handle the change of the tokens from alphabetical order and reverse.</a></li><li><a href="global.html#functionthathandletheclickonthebarandupdatetheotherscharts">function that handle the click on the bar and update the others charts</a></li><li><a href="global.html#functionthatsetsthelistoftokensfromthesimplelisttothealphabeticalcomponent">function that sets the list of tokens from the simple list to the alphabetical component</a></li><li><a href="global.html#functionthatshapedthedashboardheaderstosendittothepythonapi">function that shaped the dashboard headers to send it to the python api</a></li><li><a href="global.html#functiontorenderthetooltipfromtheargument">function to render the tooltip from the argument</a></li><li><a href="global.html#links">links</a></li><li><a href="global.html#routes">routes</a></li><li><a href="global.html#Sidebar">Sidebar</a></li><li><a href="global.html#TaggingTool">TaggingTool</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Fri Mar 12 2021 12:03:14 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
